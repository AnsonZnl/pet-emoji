# AI宠物表情包网站 - 技术文档

## 一、MVP技术栈

### 1.1 前端技术栈
**核心框架：** Next.js 14 + TypeScript + Tailwind CSS
- **Next.js 14**: 利用App Router、SSR/SSG提升SEO和加载速度，内置API路由支持
- **TypeScript**: 提高代码质量和开发效率，减少运行时错误
- **Tailwind CSS**: 原子化CSS框架，快速构建响应式UI
- **部署平台**: Vercel（免费版足够MVP使用）

### 1.2 开发工具与库
**UI组件库：**
- **React Hooks**: useState, useEffect, useRef等用于状态管理
- **react-icons**: 轻量级图标库
- **framer-motion**: 动画效果（可选，提升用户体验）

**图片处理：**
- **Next.js Image组件**: 自动优化图片加载
- **react-dropzone**: 拖拽上传功能
- **sharp**: 图片压缩和处理（Serverless函数中使用）

### 1.3 用户体验优化
**加载状态：**
- **Loading UI**: 生成过程中的视觉反馈
- **Error Handling**: 友好的错误提示
- **Responsive Design**: 移动端优先设计

## 二、AI生成服务集成

### 2.1 API架构设计
**轻量级后端架构：**
- **Next.js API Routes**: 处理敏感API密钥，封装第三方服务调用
- **Vercel Serverless Functions**: 利用免费额度处理图片上传和AI生成
- **无数据库设计**: MVP阶段无需用户系统，降低复杂度

### 2.2 AI服务选择
**推荐方案：Hugging Face Inference API**
```javascript
// API调用示例
const response = await fetch('https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-xl-base-1.0', {
  headers: {
    'Authorization': `Bearer ${process.env.HF_API_TOKEN}`,
    'Content-Type': 'application/json',
  },
  method: 'POST',
  body: JSON.stringify({ 
    inputs: prompt,
    parameters: {
      num_inference_steps: 20,
      guidance_scale: 7.5,
      width: 512,
      height: 512
    }
  }),
});
```

**免费额度：**
- 每月30,000次请求
- 足够MVP阶段使用
- 超出后可考虑付费升级

### 2.3 提示词工程
**基础提示词模板：**
```javascript
const promptTemplates = {
  cute: "cute [pet_type] emoji, adorable expression, meme style, white background, high quality",
  funny: "funny [pet_type] emoji, comical expression, meme style, white background, high quality",
  angry: "angry [pet_type] emoji, grumpy expression, meme style, white background, high quality",
  happy: "happy [pet_type] emoji, cheerful expression, meme style, white background, high quality"
};

const negativePrompt = "blurry, low quality, deformed, ugly, extra limbs, bad anatomy, text, watermark";
```

**动态提示词生成：**
```javascript
function generatePrompt(petType, emotion, style = 'cute') {
  const basePrompt = promptTemplates[style] || promptTemplates.cute;
  return basePrompt
    .replace('[pet_type]', petType)
    .replace('[emotion]', emotion);
}
```

### 2.4 图片处理流程
**上传处理：**
1. 用户上传宠物照片
2. 客户端压缩和格式验证
3. 转换为base64发送到API
4. 生成多个表情版本

**生成优化：**
- 并行生成多个表情
- 缓存常用提示词结果
- 错误重试机制

## 三、图片存储与处理

### 3.1 存储策略
**MVP阶段存储方案：**
- **用户上传图片**: 临时存储，生成后立即删除
- **生成的表情包**: 临时存储，用户下载后删除
- **存储服务**: Vercel Blob（免费额度）或Cloudinary（免费额度）

**存储流程：**
```javascript
// 上传处理示例
export default async function handler(req, res) {
  const { image, prompt } = req.body;
  
  // 1. 验证图片格式和大小
  if (!isValidImage(image)) {
    return res.status(400).json({ error: 'Invalid image format' });
  }
  
  // 2. 生成表情包
  const emojis = await generateEmojis(prompt);
  
  // 3. 返回base64编码的图片
  return res.json({ emojis });
}
```

### 3.2 图片优化
**客户端优化：**
- **压缩上传**: 客户端压缩图片减少传输时间
- **格式转换**: 统一转换为WebP格式
- **尺寸限制**: 限制上传图片最大尺寸

**服务端优化：**
- **缓存机制**: 缓存相同提示词的结果
- **批量生成**: 一次生成多个表情版本
- **错误处理**: 友好的错误提示和重试机制

### 3.3 安全性考虑
**上传安全：**
- MIME类型验证
- 文件大小限制（最大5MB）
- 图片内容检测

**API安全：**
- 环境变量存储API密钥
- 请求频率限制
- CORS配置

## 四、部署与SEO优化

### 4.1 部署配置
**Vercel部署：**
```json
// vercel.json
{
  "functions": {
    "app/api/**/*.js": {
      "maxDuration": 30
    }
  },
  "env": {
    "HF_API_TOKEN": "@hf-api-token"
  }
}
```

**环境变量配置：**
- `HF_API_TOKEN`: Hugging Face API密钥
- `NEXT_PUBLIC_SITE_URL`: 网站URL
- `GOOGLE_ADSENSE_CLIENT`: AdSense客户端ID（后续添加）

### 4.2 SEO优化实现
**页面元数据：**
```javascript
// app/layout.tsx
export const metadata = {
  title: 'Pet Emoji Generator - Transform Your Pet Into Amazing Emojis',
  description: 'Create AI-generated pet emojis from your pet photos. Free, fast, and fun! Upload your pet photo and get cute emoji versions instantly.',
  keywords: 'pet emoji, AI pet generator, pet meme, cute pet emoji, pet photo to emoji',
  openGraph: {
    title: 'Pet Emoji Generator - AI Pet Emoji Maker',
    description: 'Transform your pet photos into adorable emojis with AI',
    images: ['/og-image.jpg'],
  },
  twitter: {
    card: 'summary_large_image',
    title: 'Pet Emoji Generator',
    description: 'Transform your pet photos into adorable emojis with AI',
  }
};
```

**结构化数据：**
```javascript
// 添加JSON-LD结构化数据
const structuredData = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Pet Emoji Generator",
  "description": "AI-powered pet emoji generator",
  "url": "https://pet-emoji.com",
  "applicationCategory": "MultimediaApplication",
  "operatingSystem": "Web Browser"
};
```

### 4.3 AdSense集成准备
**广告组件：**
```javascript
// components/AdSense.js
import Script from 'next/script';

export default function AdSense({ slot, format = 'auto' }) {
  return (
    <>
      <Script
        async
        src={`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-${process.env.NEXT_PUBLIC_ADSENSE_CLIENT}`}
        strategy="afterInteractive"
      />
      <ins
        className="adsbygoogle"
        style={{ display: 'block' }}
        data-ad-client={`ca-pub-${process.env.NEXT_PUBLIC_ADSENSE_CLIENT}`}
        data-ad-slot={slot}
        data-ad-format={format}
        data-full-width-responsive="true"
      />
    </>
  );
}
```

**广告位置：**
- Hero Section下方
- 结果展示区域下方
- 页面底部

## 五、成本控制与监控

### 5.1 免费资源利用
**Vercel免费额度：**
- 每月100GB带宽
- 100GB函数执行时间
- 无限静态文件托管

**Hugging Face免费额度：**
- 每月30,000次API调用
- 足够MVP阶段使用

**存储免费额度：**
- Vercel Blob: 1GB存储
- Cloudinary: 25GB存储，25GB带宽

### 5.2 成本监控
**API使用监控：**
```javascript
// 添加使用统计
const trackUsage = async (endpoint, cost) => {
  // 记录API调用次数和成本
  console.log(`API call to ${endpoint}, estimated cost: ${cost}`);
};
```

**成本预警：**
- 设置API调用次数阈值
- 监控免费额度使用情况
- 超出时考虑付费升级

### 5.3 性能优化
**前端优化：**
- Next.js Image组件自动优化
- 代码分割和懒加载
- 静态资源CDN加速

**后端优化：**
- API响应缓存
- 并行处理多个请求
- 错误重试机制
