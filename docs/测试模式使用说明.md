# 测试模式使用说明

## 🧪 什么是测试模式？

测试模式是为了节省开发和测试成本而设计的功能。在测试模式下，系统不会调用豆包大模型API，而是返回预设的模拟数据，从而避免产生API调用费用。

## 🚀 如何启用测试模式？

### 方法1：URL参数
在网站URL后添加 `?test=true` 参数：

```
http://localhost:3000?test=true
```

### 方法2：直接访问测试链接
- **本地开发**: http://localhost:3000?test=true
- **生产环境**: https://your-domain.com?test=true

## 📋 测试模式功能

### ✅ 启用的功能
1. **模拟数据返回**: 返回预设的表情包数据
2. **数据库保存**: 测试数据会保存到Supabase数据库
3. **完整流程**: 除了AI调用外，其他流程完全一致
4. **UI提示**: 页面顶部会显示测试模式提示横幅

### ❌ 禁用的功能
1. **豆包API调用**: 不会调用真实的AI模型
2. **Token消耗**: 不会产生任何API费用
3. **R2上传**: 使用固定的测试图片URL

## 🎯 测试模式数据

测试模式返回的模拟数据：

```json
{
  "success": true,
  "emojis": [
    {
      "id": "emoji_grid_[timestamp]",
      "description": "[style] style emoji grid",
      "style": "[selected_style]",
      "type": "grid",
      "url": "https://5c4526fa64900b23d9572f57b126ea45.r2.cloudflarestorage.com/emoji-packs/emoji_pack_cute_1758082762296.jpeg",
      "size": "2048x2048",
      "timestamp": "[current_time]"
    }
  ],
  "usage": {
    "generated_images": 1,
    "output_tokens": 16384,
    "total_tokens": 16384
  },
  "model": "doubao-seedream-4-0-250828"
}
```

## 🔧 技术实现

### API层面
- 检测URL参数 `test=true`
- 跳过豆包API调用
- 返回预设的模拟响应
- 保存测试数据到数据库（tokens_used = 0）

### 前端层面
- 检测URL参数显示测试模式提示
- API调用时自动添加test参数
- 提供退出测试模式的链接

## 📊 数据库记录

测试模式下的数据库记录特点：
- `doubao_request_id`: 以 `test_` 开头
- `tokens_used`: 设置为 0
- `status`: 'completed'
- 其他字段与正常模式一致

## ⚠️ 注意事项

1. **仅用于测试**: 测试模式仅用于开发和功能测试
2. **固定图片**: 返回的图片URL是固定的测试图片
3. **数据库影响**: 测试数据会保存到数据库中
4. **生产环境**: 生产环境中也可以使用，但请谨慎使用

## 🎨 使用场景

### 开发阶段
- 功能开发和调试
- UI界面测试
- 数据库集成测试

### 演示阶段
- 产品演示
- 功能展示
- 用户体验测试

### 成本控制
- 避免频繁的API调用费用
- 大量测试时的成本节省

## 🔄 退出测试模式

### 方法1：点击提示横幅中的链接
页面顶部的黄色提示横幅中有"退出测试模式"链接

### 方法2：直接访问正常URL
访问不带 `?test=true` 参数的URL：
```
http://localhost:3000
```

### 方法3：刷新页面并修改URL
手动删除URL中的 `?test=true` 参数后刷新页面

## 📈 监控和日志

测试模式下的日志输出：
- 服务端：`🧪 Test mode activated - returning mock data`
- 客户端：`🧪 Test mode: Using mock data instead of calling AI model`
- 数据库：`✅ Test data saved to database`

这些日志可以帮助你确认测试模式是否正常工作。